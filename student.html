<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student</title>
    <!-- ... inside your <head> tag ... -->
    <!-- ... rest of your <head> tag ... -->

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
      crossorigin="anonymous"
    />
    <style>
      body {
        background-color: rgb(216, 216, 216);
      }
      #profilebtn,
      #logoutbtn {
        padding: 10px;
        margin: 10px;
        margin-top: 20px;
        border-color: gray;
        color: white;
      }
      #profilebtn:hover,
      #logoutbtn:hover {
        background-color: transparent;
        box-shadow: 3px 3px 3px #545959;
        transition: 0.2s;
      }
      .login-card.card.w-75.mb-3.shadow.p-3.mb-5.bg-body-tertiary.rounded {
        margin: auto;
        position: relative;
        top: 2rem;
        background-color: #f4f4f4;
        display: none;
      }
      .login-card.card.w-75.mb-3.shadow.p-3.mb-5.bg-body-tertiary.rounded.view {
        display: block;
      }
      #statusbtn {
        position: relative;
        top: 20px;
        background: rgb(2, 0, 36);
        background: linear-gradient(
          90deg,
          rgba(2, 0, 36, 1) 0%,
          rgba(0, 212, 255, 1) 94%
        );
        color: white;
      }
      #historybtn {
        position: relative;
        top: 20px;
        background: rgb(2, 0, 36);
        background: linear-gradient(
          90deg,
          rgba(2, 0, 36, 1) 0%,
          rgba(0, 212, 255, 1) 94%
        );
        color: white;
      }
      #applyodbtn {
        border-radius: 20px;
        position: relative;
        top: 2rem;
        left: 2rem;
        background: rgb(2, 0, 36);
        background: linear-gradient(
          90deg,
          rgba(2, 0, 36, 1) 0%,
          rgba(0, 212, 255, 1) 94%
        );
        color: white;
        border: 0px;
      }
      .status-card.card.mt-2.shadow.p-3.mb-5.bg-body-tertiary.rounded {
        display: none;
        position: relative;
        top: 20px;
      }
      .status-card.card.mt-2.shadow.p-3.mb-5.bg-body-tertiary.rounded.view {
        display: block;
      }
      .card.w-75.mb-4.mx-auto.shadow.p-3.mb-5.bg-body-tertiary.rounded {
        position: relative;
        top: 30px;
        display: none;
      }
      .card.w-75.mb-4.mx-auto.shadow.p-3.mb-5.bg-body-tertiary.rounded.view {
        display: block;
      }
      .bg {
        background: rgb(2, 0, 36);
        background: linear-gradient(
          90deg,
          rgba(2, 0, 36, 1) 0%,
          rgba(0, 212, 255, 1) 94%
        );
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="collapse" id="navbarToggleExternalContent" data-bs-theme="dark">
      <div class="bg p-4">
        <h5 class="text-body-emphasis h4">
          <span
            ><svg
              style="position: relative; bottom: 4px; margin-right: 10px"
              xmlns="http://www.w3.org/2000/svg"
              width="25"
              height="25"
              fill="currentColor"
              class="bi bi-person-fill"
              viewBox="0 0 16 16"
            >
              <path
                d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
              /></svg></span
          >20CSA40
        </h5>
      </div>
    </div>
    <nav class="navbar bg">
      <div class="container-fluid">
        <button
          id="profilebtn"
          class="navbar-toggler btn-bg"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarToggleExternalContent"
          aria-controls="navbarToggleExternalContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span>Profile</span>
        </button>
        <button id="logoutbtn" class="navbar-toggler" type="button">
          <span style="font-weight: 400">Logout</span>
        </button>
      </div>
    </nav>
    <div class="mx-auto mb-4">
      <button id="applyodbtn" class="btn btn-info">
        <span id="plusicon"
          ><svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-plus-lg"
            viewBox="0 0 16 16"
          >
            <path
              fill-rule="evenodd"
              d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"
            />
          </svg>
        </span>
        Apply For Od
      </button>
    </div>
    <form id="contents">
      <div
        id="applyod"
        class="login-card card w-75 mb-3 shadow p-3 mb-5 bg-body-tertiary rounded"
      >
        <div class="card-body">
          <div class="input-group mb-4">
            <span class="input-group-text" id="basic-addon1"
              >Student Name:</span
            >
            <input
              type="text"
              id="studentname"
              class="form-control"
              placeholder="Student Name"
              aria-label="Username"
              aria-describedby="basic-addon1"
            />
          </div>
          <div class="input-group mb-4">
            <span class="input-group-text" id="basic-addon1">Roll no :</span>
            <input
              type="text"
              id="rollno"
              class="form-control"
              placeholder="Roll no"
              aria-label="Username"
              aria-describedby="basic-addon1"
            />
          </div>
          <div class="input-group mb-4">
            <span class="input-group-text">Reason for OD:</span>
            <textarea
              id="reasonforod"
              class="form-control"
              aria-label="With textarea"
            ></textarea>
          </div>
          <div class="row">
            <div class="col">
              <div class="input-group mb-4">
                <label class="input-group-text" for="fromdate"
                  >From Date:</label
                >
                <input id="fromdate" type="date" class="form-control" />
              </div>
            </div>
            <div class="col">
              <div class="input-group mb-4">
                <label class="input-group-text" for="todate">To Date:</label>
                <input id="todate" type="date" class="form-control" />
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="input-group mb-4">
                <label class="input-group-text" for="studentYear">Year</label>
                <input type="text" id="year">
              </div>
            </div>
            <div class="col">
              <div class="input-group mb-4">
                <label class="input-group-text" for="studentDept">Department</label>
                <input type="text" id="dept">
              </div>
            </div>
          </div>
          <div class="d-grid col-6 mx-auto">
            <button id="odsubmit" class="btn btn-primary" type="button">
              Apply OD
            </button>
          </div>
        </div>
      </div>
    </form>
    <div>
      <div class="d-grid col-6 mx-auto">
        <button id="statusbtn" type="button" class="btn btn-info mb-4">
          View OD Status
        </button>
        <div
          class="status-card card mt-2 shadow p-3 mb-5 bg-body-tertiary rounded"
          id="statusbar"
        >
          <div class="card-body">
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">Mentor</th>
                  <th scope="col">Hod</th>
                  <th scope="col">Principal</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Pending</td>
                  <td>Pending</td>
                  <td>Pending</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div>
      <div class="d-grid gap-2 col-6 mx-auto mb-4">
        <button id="historybtn" class="btn btn-info" type="button">
          History of OD
        </button>
      </div>
      <div
        id="history"
        class="card w-75 mb-4 mx-auto shadow p-3 mb-5 bg-body-tertiary rounded"
      >
        <div class="card-body">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Reason For Od</th>
                <th scope="col">From-To Date</th>
                <th scope="col">Year & Sec</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
      crossorigin="anonymous"
    ></script>
    <script src="./student.js"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.0.1/firebase-analytics.js";
      import { getAuth } from "https://www.gstatic.com/firebasejs/9.0.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
        doc,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/9.0.1/firebase-firestore.js";
      const firebaseConfig = {
        apiKey: "AIzaSyCb5rHQgaeYJgHFapU_KkpSobPoWCezFhA",
        authDomain: "od-project-b00da.firebaseapp.com",
        projectId: "od-project-b00da",
        storageBucket: "od-project-b00da.appspot.com",
        messagingSenderId: "309156647421",
        appId: "1:309156647421:web:ae8a858791f279acf14994",
        measurementId: "G-6YBET1MVLK",
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth();

      document
        .getElementById("odsubmit")
        .addEventListener("click", async (event) => {
          event.preventDefault();
          const form = document.getElementById("contents");
          const studentname = document.getElementById("studentname").value;
          const rollno = document.getElementById("rollno").value;
          const reasonforod = document.getElementById("reasonforod").value;
          const fromdate = document.getElementById("fromdate").value;
          const todate = document.getElementById("todate").value;
          const studentYear = document.getElementById("studentYear").value;
          const studentDept = document.getElementById("studentDept").value;
          let odlist = [];
          try {
            const db = getFirestore(app);
            const data = await getDocs(collection(db, "users"));
            data.forEach(async (info) => {
              let dataset = info.data();
              let login = document.cookie.split(",");
              const docRef = doc(db, "users", info.id);
              if (dataset.username == login[0]) {
                if (dataset.odlist) {
                  odlist = dataset.odlist;
                  odlist.push({
                    StudentName: studentname,
                    RollNo: rollno,
                    Reason: reasonforod,
                    OdFrom: fromdate,
                    To: todate,
                    CurrentYear: studentYear,
                    dept: studentDept,
                    mentor: "pending",
                    hod: "pending",
                    principal: "pending",
                  });
                } else {
                  odlist.push({
                    StudentName: studentname,
                    RollNo: rollno,
                    Reason: reasonforod,
                    OdFrom: fromdate,
                    To: todate,
                    CurrentYear: studentYear,
                    dept: studentDept,
                    mentor: "pending",
                    hod: "pending",
                    principal: "pending",
                  });
                }
                setDoc(docRef, {
                  username: login[0],
                  password: login[1],
                  odlist: odlist,
                })
                  .then(() => {
                    alert("yes");
                    odlist = [];
                  })
                  .catch((error) => {
                    console.log(error);
                    odlist = [];
                  });
              }
            });

            form.reset();
          } catch (error) {
            console.log("Upload error:", error);
          }
        });
    </script>
  </body>
</html>
